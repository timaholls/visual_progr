# Документация по проекту "Взаимодействие с моделью данных EDM"

## Общая структура проекта

Проект представляет собой WPF-приложение для работы с данными о сотрудниках и их должностях с использованием технологии Entity Framework (модель EDM). Проект организован с использованием архитектурного паттерна MVVM (Model-View-ViewModel).

## Структура проекта

```
/5
├── Model/                  # Модели данных
│   ├── Person.cs           # Модель сотрудника
│   ├── Role.cs             # Модель должности
│   └── CompanyEntities.cs  # Контекст базы данных
├── ViewModel/              # Классы ViewModel
│   ├── PersonViewModel.cs  # ViewModel для работы с сотрудниками
│   └── RoleViewModel.cs    # ViewModel для работы с должностями
├── View/                   # Представления (окна)
│   ├── WindowNewPerson.xaml   # Окно добавления/редактирования сотрудника
│   └── WindowNewRole.xaml     # Окно добавления/редактирования должности
├── App.xaml                # Приложение WPF
├── App.config              # Конфигурация приложения и EF
├── MainWindow.xaml         # Главное окно приложения
└── 5.csproj                # Файл проекта
```

## Подробное описание файлов

### Модели данных (Model)

#### Person.cs

```csharp
public class Person
{
    public int Id { get; set; }
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public DateTime Birthday { get; set; }
    public int RoleId { get; set; }
    public virtual Role Role { get; set; }
}
```

**Описание:** Класс представляет сущность "Сотрудник". Содержит базовые свойства сотрудника, такие как идентификатор, имя, фамилия, дата рождения. Реализует связь с сущностью "Должность" (Role) через внешний ключ RoleId и навигационное свойство Role.

#### Role.cs

```csharp
public class Role
{
    public Role()
    {
        Persons = new List<Person>();
    }
    
    public int Id { get; set; }
    public string NameRole { get; set; }
    public virtual ICollection<Person> Persons { get; set; }
}
```

**Описание:** Класс представляет сущность "Должность". Содержит свойства идентификатора и наименования должности. Реализует связь "один-ко-многим" с сущностью "Сотрудник" через коллекцию Persons. Конструктор класса инициализирует пустую коллекцию Persons, что предотвращает ошибки NullReferenceException.

#### CompanyEntities.cs

```csharp
public class CompanyEntities : DbContext
{
    public CompanyEntities() : base("name=CompanyEntities")
    {
    }

    public DbSet<Role> Roles { get; set; }
    public DbSet<Person> Persons { get; set; }
}
```

**Описание:** Класс-контекст Entity Framework, наследуемый от DbContext. Является центральным компонентом модели EDM, обеспечивающим взаимодействие с базой данных. Содержит DbSet для сущностей Role и Person, что позволяет выполнять операции CRUD с этими сущностями. Конструктор передает строку подключения "CompanyEntities" в базовый класс, которая определена в App.config.

### Классы ViewModel

#### PersonViewModel.cs

**Назначение:** Класс представляет модель представления для работы с данными сотрудников.

**Основные компоненты:**
- `_listPerson` - приватное поле, хранящее коллекцию сотрудников
- `context` - экземпляр контекста базы данных
- `ListPerson` - свойство для доступа к коллекции сотрудников
- `GetPersons()` - метод загрузки сотрудников из базы данных с присоединением связанной сущности Role
- `AddPerson()` - метод добавления нового сотрудника
- `EditPerson()` - метод редактирования данных сотрудника
- `DeletePerson()` - метод удаления сотрудника с проверками и обработкой ошибок

**Логика работы:**
- При инициализации создаётся контекст и загружаются данные о сотрудниках
- Методы CRUD обеспечивают взаимодействие с базой данных, сохраняя изменения через контекст
- Обеспечивается синхронизация коллекции _listPerson с данными базы
- Реализована обработка ошибок для предотвращения некорректного поведения приложения

#### RoleViewModel.cs

**Назначение:** Класс представляет модель представления для работы с данными должностей.

**Основные компоненты:**
- `_listRole` - приватное поле, хранящее коллекцию должностей
- `context` - экземпляр контекста базы данных
- `ListRole` - свойство для доступа к коллекции должностей
- `GetRoles()` - метод загрузки должностей из базы данных
- `AddRole()` - метод добавления новой должности
- `EditRole()` - метод редактирования данных должности
- `DeleteRole()` - метод удаления должности с проверкой на наличие связанных сотрудников

**Логика работы:**
- При инициализации создаётся контекст и загружаются данные о должностях
- Методы CRUD обеспечивают взаимодействие с базой данных
- Реализована проверка на целостность данных при удалении должностей
- Обработка ошибок и информирование пользователя о результатах операций

### Представления (View)

#### MainWindow.xaml и MainWindow.xaml.cs

**Назначение:** Главное окно приложения, обеспечивающее интерфейс для работы с данными.

**Основные компоненты:**
- TabControl с вкладками "Сотрудники", "Должности" и "Выход"
- DataGrid для отображения списка сотрудников и должностей
- Кнопки для добавления, редактирования и удаления записей

**Логика работы:**
- Инициализирует экземпляры PersonViewModel и RoleViewModel
- Привязывает данные к элементам управления через ItemsSource
- Обрабатывает события взаимодействия пользователя с интерфейсом
- Открывает дополнительные окна для добавления/редактирования данных

#### WindowNewPerson.xaml и WindowNewPerson.xaml.cs

**Назначение:** Окно для добавления нового сотрудника или редактирования существующего.

**Основные компоненты:**
- Поля ввода данных сотрудника (имя, фамилия, дата рождения)
- ComboBox для выбора должности
- Кнопки сохранения и отмены

**Логика работы:**
- Инициализирует RoleViewModel для загрузки списка должностей
- Устанавливает DataContext для привязки данных
- Валидирует введенные данные перед сохранением
- Возвращает DialogResult.True при успешном сохранении

#### WindowNewRole.xaml и WindowNewRole.xaml.cs

**Назначение:** Окно для добавления новой должности или редактирования существующей.

**Основные компоненты:**
- Поле ввода наименования должности
- Кнопки сохранения и отмены

**Логика работы:**
- Устанавливает фокус на поле ввода
- Валидирует введенные данные
- Возвращает DialogResult.True при успешном сохранении

### Конфигурация

#### App.config

**Назначение:** Конфигурационный файл приложения и Entity Framework.

**Основные компоненты:**
- Строка подключения к базе данных (LocalDB)
- Конфигурация EntityFramework
- Настройки провайдера данных

**Логика работы:**
- Определяет параметры подключения к базе данных
- Конфигурирует Entity Framework для работы с LocalDB
- Обеспечивает создание базы данных при первом запуске через Code First

#### App.xaml и App.xaml.cs

**Назначение:** Определяет глобальные ресурсы приложения и точку входа.

**Логика работы:**
- Устанавливает MainWindow как стартовое окно приложения
- Инициализирует приложение WPF

## Взаимодействие компонентов

1. **Инициализация приложения:**
   - App.xaml запускает MainWindow
   - MainWindow создает экземпляры ViewModel
   - ViewModel загружают данные через контекст CompanyEntities

2. **Отображение данных:**
   - ViewModel предоставляют коллекции ListRole и ListPerson
   - DataGrid связываются с этими коллекциями через ItemsSource
   - Пользователь видит данные в табличном представлении

3. **Добавление новых данных:**
   - Пользователь нажимает кнопку "Добавить"
   - Открывается WindowNewRole или WindowNewPerson
   - Пользователь вводит данные и сохраняет их
   - ViewModel добавляет новую запись в базу данных и обновляет коллекцию

4. **Редактирование данных:**
   - Пользователь выбирает запись и нажимает "Редактировать"
   - Открывается окно редактирования с предзаполненными данными
   - После изменения ViewModel обновляет запись в базе данных

5. **Удаление данных:**
   - Пользователь выбирает запись и нажимает "Удалить"
   - ViewModel выполняет проверки (например, на связанные данные)
   - После подтверждения пользователем запись удаляется

## Особенности реализации

- **Code First подход** - модель данных определяется в коде, база данных создается автоматически
- **Lazy Loading** - навигационные свойства отмечены как virtual для поддержки отложенной загрузки
- **Обработка ошибок** - реализована система обработки исключений для предотвращения сбоев
- **Валидация данных** - проверка вводимых данных для обеспечения целостности
- **Обновление коллекций** - синхронизация данных между представлением и базой данных

## Заключение

Разработанное приложение демонстрирует основные принципы работы с Entity Framework и моделью EDM в контексте WPF-приложения с использованием архитектурного паттерна MVVM. Приложение обеспечивает полный цикл операций CRUD над сущностями "Сотрудник" и "Должность", поддерживая целостность данных и обрабатывая исключительные ситуации. 